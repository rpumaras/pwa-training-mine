'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _connector = require('../connector');

var _connector2 = _interopRequireDefault(_connector);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var Monetate = function (_Connector) {
    (0, _inherits3.default)(Monetate, _Connector);

    function Monetate() {
        var displayName = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Monetate';
        var tagUrl = arguments[1];
        var options = arguments[2];
        (0, _classCallCheck3.default)(this, Monetate);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Monetate.__proto__ || (0, _getPrototypeOf2.default)(Monetate)).call(this, displayName, options));

        if (!tagUrl) {
            throw new Error('tagUrl cannot be undefined');
        }

        _this.monetateSelectors = ['div[id*="monetate_selector"]'];

        window.monetateQ = window.monetateQ || [];

        /* istanbul ignore next */
        _connector2.default.loadScript('' + (location.protocol === 'https:' ? 'https://s' : 'http://') + tagUrl, _this);
        return _this;
    }

    (0, _createClass3.default)(Monetate, [{
        key: 'pageviewEvent',
        value: function pageviewEvent() {
            // Clean monetate injected elements
            var monetateInserts = document.querySelectorAll(this.monetateSelectors.join(','));
            monetateInserts.forEach(function (insertedElement) {
                insertedElement.remove();
            });

            // We _don't_ clean up any styles that may have been injected
            // as monetate doesn't re-add them when we re-run experiments (below)
            // As a result, marketers using Monetate with a PWA will have
            // to work within the following limitations:
            //  1) Use selectors that correctly applies only to the elements
            //     they want to style on _only_ the pages they want to apply to.
            //  2) URL-based guards cannot be used as we cannot add/remove
            //     these custom CSS styles on soft navigations.

            // Run Monetate Experiment (after cleanup)
            this.send(['trackData']);
        }
    }, {
        key: 'send',
        value: function send() {
            for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
                args[_key] = arguments[_key];
            }

            window.monetateQ.push(args);
        }
    }]);
    return Monetate;
}(_connector2.default); /* * *  *  * *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  * */
/* Copyright (c) 2018 Mobify Research & Development Inc. All rights reserved. */
/* * *  *  * *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  * */

exports.default = Monetate;