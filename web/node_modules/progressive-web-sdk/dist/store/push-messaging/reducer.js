'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.initialState = undefined;

var _defineProperty2 = require('babel-runtime/helpers/defineProperty');

var _defineProperty3 = _interopRequireDefault(_defineProperty2);

var _fromJS, _handleActions; /* * *  *  * *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  * */
/* Copyright (c) 2018 Mobify Research & Development Inc. All rights reserved. */
/* * *  *  * *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  * */

var _immutable = require('immutable');

var _reduxActions = require('redux-actions');

var _actions = require('./actions');

var messagingActions = _interopRequireWildcard(_actions);

var _constants = require('./constants');

var _messaging = require('../../utils/messaging');

var _reducerUtils = require('../../utils/reducer-utils');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var initialState = exports.initialState = (0, _immutable.fromJS)((_fromJS = {
    subscribed: false,
    canSubscribe: false,
    channels: []
}, (0, _defineProperty3.default)(_fromJS, _constants.PAGE_COUNT, 0), (0, _defineProperty3.default)(_fromJS, _constants.VISIT_COUNTDOWNS, {}), (0, _defineProperty3.default)(_fromJS, 'systemAskShown', false), (0, _defineProperty3.default)(_fromJS, 'locale', ''), (0, _defineProperty3.default)(_fromJS, 'isReady', false), (0, _defineProperty3.default)(_fromJS, 'isSupported', (0, _messaging.isMessagingSupported)()), (0, _defineProperty3.default)(_fromJS, 'status', _constants.MESSAGING_STATUS.LOADING), _fromJS));

var pushMessagingReducer = (0, _reduxActions.handleActions)((_handleActions = {}, (0, _defineProperty3.default)(_handleActions, messagingActions.stateUpdate, _reducerUtils.mergePayload), (0, _defineProperty3.default)(_handleActions, messagingActions.messagingSystemAskShown, _reducerUtils.mergePayload), (0, _defineProperty3.default)(_handleActions, messagingActions.onRehydratedPageCount, function (state, _ref) {
    var payload = _ref.payload;

    return state.update(_constants.PAGE_COUNT, function (pageCount) {
        return pageCount + payload;
    });
}), (0, _defineProperty3.default)(_handleActions, messagingActions.onPageCountIncrement, function (state) {
    return state.update(_constants.PAGE_COUNT, function (pageCount) {
        return ++pageCount;
    });
}), (0, _defineProperty3.default)(_handleActions, messagingActions.onRehydratedVisitCountdowns, _reducerUtils.mergePayload), (0, _defineProperty3.default)(_handleActions, messagingActions.onVisitCountdownStarted, function (state, _ref2) {
    var payload = _ref2.payload;

    return state.setIn([_constants.VISIT_COUNTDOWNS, payload[_constants.CHANNEL_NAME]], payload[_constants.VISITS_TO_WAIT]);
}), (0, _defineProperty3.default)(_handleActions, messagingActions.onDecreaseVisitCountdowns, function (state) {
    return state.update(_constants.VISIT_COUNTDOWNS, function (visitCountdowns) {
        return visitCountdowns.map(function (value) {
            return Math.max(--value, 0);
        });
    });
}), (0, _defineProperty3.default)(_handleActions, messagingActions.onLocaleSet, _reducerUtils.mergePayload), _handleActions), initialState);

exports.default = pushMessagingReducer;